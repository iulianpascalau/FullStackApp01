pipeline {
    agent any
    
    parameters {
        string(name: 'BRANCH_OR_TAG', defaultValue: 'main', description: 'Branch or Tag to deploy (e.g., main, v1.0.0)')
    }
    
    environment {
        // Update these values
        PROD_VM_USER = 'ubuntu'
        PROD_VM_IP = 'YOUR_VM_IP_ADDRESS' 
        PROJECT_PATH = '/home/ubuntu/app'
    }

    stages {
        stage('Deploy to Prod') {
            steps {
                // Requires 'ssh-agent' plugin and credentials in Jenkins
                sshagent(['prod-vm-ssh-key']) {
                    script {
                        def remoteCmd = "cd ${PROJECT_PATH} && ./scripts/deploy.sh ${params.BRANCH_OR_TAG}"
                        sh "ssh -o StrictHostKeyChecking=no ${PROD_VM_USER}@${PROD_VM_IP} '${remoteCmd}'"
                    }
                }
            }
        }
    }
}
